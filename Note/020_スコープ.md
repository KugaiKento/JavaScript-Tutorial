> 実行中のコードから値と式が参照できる範囲<br>

JavaScript は一行一行実行されている言語だが、その実行行から見えてくる値と式をスコープという。

---

## JavaScript のスコープの種類

- グローバルスコープ
- スクリプトスコープ
- 関数スコープ
- ブロックスコープ
- モジュールスコープ

### グローバルスコープ

- var 変数や function で宣言を行った場合には window オブジェクトのプロパティとして値が保持される。
- JavaScript では window オブジェクト自体がグローバルスコープになる。

### スクリプトスコープ

- let や const はスクリプトスコープになる。ただし一般的にはスクリプトスコープもグローバルスコープと呼ぶ。
- ただし異なるスコープということは覚えておく必要がある。

### 関数スコープ

- 関数の波カッコの`function {}`中に書かれたものを関数スコープと呼ぶ。
- 関数スコープの外から関数内に定義された変数にはアクセスできない。

### ブロックスコープ

- 波カッコ`{}`で囲まれた範囲の事をブロックスコープという。
- let または const を使用することが条件になる。
- ブロックスコープの外からは値を取得できない。
- ただし var 変数はブロックスコープが無視されるため、このような理由からも var は非推奨とされている。
- function 宣言でもブロックスコープは無視される。
- 一般的には`if`文や`for`文などと一緒にブロックスコープは生成される。

## レキシカルスコープ

> レキシカル：語彙の、辞書的な～<br>

- プログラミングにおけるレキシカルはソースコードのどこに何を書いているかという意味。
- ソースコードが記載している場所、というのがレキシカルという意味になる。
- コードを書く場所によって参照できる変数が変わるスコープの事を言う。
- 実行中のコードから見た外部スコープの事をレキシカルスコープとも表現する。<br>

静的スコープとも呼ばれる。<br>

以下のようなコードがあるとする。

```Javascript

let x = 1;

function outer() {
  let x = 2;

  function inner() {
    console.log(x);
  }

  return inner;
}

let fn = outer();
fn(); // 2 が出力される


```

このとき、createCounter が返した無名関数が count を参照しているため、JavaScript エンジンは count を解放せずに保持する。これはスコープチェーンによって、その無名関数が外側の createCounter の環境（レキシカルスコープ）を参照し続けているためである。

## クロージャー

> レキシカルスコープの変数を関数が使用している状態

関数が高い階層で定義されていた時に、外側の関数で定義された変数を内側の関数から参照できる状態を指す。関数が定義されたときのスコープを保持し続ける仕組みをクロージャーという。<br>

以下のようなコードがあるとする。

```JavaScript

function createCounter() {
  let count = 0; // 外部から直接は見えない変数（プライベート変数）

  return function() {
    count++;
    return count;
  };
}

const counter = createCounter();

console.log(counter()); // 1
console.log(counter()); // 2
console.log(counter()); // 3

```

このとき、`inner`が`x`を参照しているため、JavaScript エンジンは`x`を解放せずに保持する。これはスコープチェーンにより`inner`が外側の環境を参照し続けているためである。<br>

また上記のような、クロージャーを用いることでプライベート変数の定義ができるようにもなる。

## 動的な関数の生成

クロージャーを用いることで、状況に応じて異なる結果を返す関数を動的に作成することができる。

```JavaScript

// 動的な関数生成
function addNumberFactory(num) {
  function addNumber(value) {
    return num + value;
  }

  return addNumber;
}

//出力は15になる。
const add5 = addNumberFactory(5);
const result = add5(10);
console.log(result);

```

## スコープチェーン

> スコープが複数階層で、連なっている状態の事を指す。

ある変数にアクセスするときに、JavaScript エンジンは今実行しているスコープから外側へ向かって順に探すという仕組みを持っている。この探索の連なりをスコープチェーンと呼ぶ。

以下のようなコードがあるとする。

```JavaScript

let x = 10; // グローバルスコープ

function outer() {
  let y = 20; // outer関数スコープ

  function inner() {
    let z = 30; // inner関数スコープ
    console.log(x); // 10（グローバルを参照）
    console.log(y); // 20（outerを参照）
    console.log(z); // 30（innerを参照）
  }

  inner();
}

outer();

```

この場合のスコープチェーンは inner 関数スコープ z がある。次に outer 関数スコープ y がある。最後にグローバルスコープ x があるという順で変数を探していく。

ここで、console.log(a)のように存在しない変数を探すと、スコープチェーンはすべて探索した後に RefernceError となる。
